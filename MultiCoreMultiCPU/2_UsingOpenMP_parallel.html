
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2.2. Creating SPMD parallelism using OpenMP parallel directive &#8212; Parallel Programming and Performance Optimization With OpenMP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'MultiCoreMultiCPU/2_UsingOpenMP_parallel';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="2.3. Creating SPMD parallelism using OpenMP teams directive" href="3_UsingOpenMP_teams.html" />
    <link rel="prev" title="2.1. Multicore and Multi-CPU shared memory systems" href="1_MIMDArchitecture.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Parallel Programming and Performance Optimization With OpenMP - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Parallel Programming and Performance Optimization With OpenMP - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../cover.html">
                    OpenMP Programming Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book_intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../foreword.html">foreword</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">preface</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ch1_OpenmpIntro.html">1. Overview of OpenMP Programming</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Openmp_C/1_IntroductionOfOpenMP.html">1.1. Introduction of OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Openmp_C/2_Syntax.html">1.2. Creating a Parallel Program with OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Openmp_C/3_Performance.html">1.3. Performance Analysis</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../Ch2_MulticoreMultiCPU.html">2. Parallel Programming for Multicore and Multi-CPU Machines</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_MIMDArchitecture.html">2.1. Multicore and Multi-CPU shared memory systems</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">2.2. Creating SPMD parallelism using OpenMP <strong>parallel</strong> directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_UsingOpenMP_teams.html">2.3. Creating SPMD parallelism using OpenMP <code class="docutils literal notranslate"><span class="pre">teams</span></code> directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_SynchronizationThreads.html">2.4. Synchronization of Threads Using Barrier and Ordered Directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_AsynchronousTasking.html">2.5. Asynchronous tasking</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_ExplicitDistribution.html">2.6. Explicit distribution of work using single, sections, workshring-loop, and distribute construct</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ch3_SIMDVector.html">3. Parallel Programming for SIMD and Vector Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../SIMDandVectorArchitecture/plan.html">3.1. Parallel Programming for SIMD and Vector Architecture</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ch4_GPUAccel.html">4. Parallel Programming for GPU Accelerators</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../GPUAccelerators/1_architecture.html">4.1. Vector Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GPUAccelerators/1_DataMapping.html">4.2. Data Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GPUAccelerators/2_Metadirective.html">4.3. Metadirective (possible separate section)</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/passlab/OpenMPProgrammingBook/main?urlpath=lab/tree/src/MultiCoreMultiCPU/2_UsingOpenMP_parallel.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/passlab/OpenMPProgrammingBook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/passlab/OpenMPProgrammingBook/issues/new?title=Issue%20on%20page%20%2FMultiCoreMultiCPU/2_UsingOpenMP_parallel.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/MultiCoreMultiCPU/2_UsingOpenMP_parallel.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating SPMD parallelism using OpenMP parallel directive</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-started-with-parallel-directive-to-create-parallelism">2.2.1. Get Started with <strong>Parallel</strong> Directive to Create Parallelism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax-and-semantics-of-parallel-directive-and-its-clauses">2.2.2. Syntax and Semantics of <strong>Parallel</strong> Directive and Its Clauses</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-clause">2.2.2.1. <strong>if</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#num-threads-clause">2.2.2.2. <strong>num_threads</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sharing-attribute-clauses">2.2.2.3. Data-Sharing Attribute Clauses</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#private-clause">2.2.2.3.1. <strong>private</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#firstprivate-clause">2.2.2.3.2. <strong>firstprivate</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-clause">2.2.2.3.3. <strong>shared</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#default-clause">2.2.2.3.4. <strong>default</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-scoping-rules">2.2.2.3.5. Implicit Scoping Rules</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copyin-clause">2.2.2.4. <strong>copyin</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-clause">2.2.2.5. <strong>reduction</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proc-bind-clause">2.2.2.6. <strong>proc_bind</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#allocate-clause">2.2.2.7. <strong>allocate</strong> Clause</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-advanced-examples-of-using-other-clauses-and-the-analysis-of-performance-and-improvement">2.2.3. More Advanced Examples of Using Other Clauses and the Analysis of Performance and Improvement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-clause-and-num-threads-clause">2.2.3.1. <strong>if</strong> clause and <strong>num_threads</strong> clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.2.3.2. Data-Sharing Attribute Clauses</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="creating-spmd-parallelism-using-openmp-parallel-directive">
<h1><span class="section-number">2.2. </span>Creating SPMD parallelism using OpenMP <strong>parallel</strong> directive<a class="headerlink" href="#creating-spmd-parallelism-using-openmp-parallel-directive" title="Link to this heading">#</a></h1>
<p>From this part, we begin to introduce how to use OpenMP directives to write programs. We first introduce the most basic and most commonly used <strong>parallel</strong> directive.</p>
<section id="get-started-with-parallel-directive-to-create-parallelism">
<h2><span class="section-number">2.2.1. </span>Get Started with <strong>Parallel</strong> Directive to Create Parallelism<a class="headerlink" href="#get-started-with-parallel-directive-to-create-parallelism" title="Link to this heading">#</a></h2>
<p>The <strong>parallel</strong> directive is used to mark a parallel region. When a thread encounters a parallel region, a group of threads is created to execute the parallel region.
The original thread that executed the serial part will be the primary thread of the new team. All threads in the team execute parallel regions together. After a team is created, the number of threads in the team remains constant for the duration of that parallel region.</p>
<blockquote>
<div><p>Primary thread is also known as the master thread</p>
</div></blockquote>
<p>When a thread team is created, the primary thread will implicitly create as many tasks as the number of threads, each task is assigned and bounded to one thread.
When threads are all occupied, implicit tasks that have not been allocated will be suspended waiting for idle threads.</p>
<p>The following example from Chapter 1 shows how to use the parallel directive in C.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">//%</span><span class="k">compiler</span>: clang
<span class="o">//%</span><span class="k">cflags</span>: -fopenmp

<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;omp.h&gt;</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="c1">#pragma omp parallel</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hello World
Hello World
Hello World
Hello World
Hello World
Hello World
Hello World
Hello World
</pre></div>
</div>
</div>
</div>
<p>This example prints <em>Hello World</em> 8 times, which means 8 threads are created by default. The default number of threads is determined by the computer hardware, 8 threads are created on the author’s computer.
The following example shows how to use the <strong>num_threads</strong> clause in the parallel directive to specify the number of threads to create.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">//%</span><span class="k">compiler</span>: clang
<span class="o">//%</span><span class="k">cflags</span>: -fopenmp

<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;omp.h&gt;</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="c1">#pragma omp parallel num_threads(4)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hello World
Hello World
Hello World
Hello World
</pre></div>
</div>
</div>
</div>
<p>In this example, we use the <strong>num_threads</strong> clause to specify the use of 4 threads to execute the parallel region. When the master thread encounters OpenMP constructs, three threads are created, and together with these three threads, a thread group of 4 is formed.
<em>Hello World</em> is printed four times, once per thread.</p>
<p>The next two examples show how to use the <strong>parallel</strong> directive in Fortran, and they have the exactly same meaning as the two examples in C above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!!</span>%compiler:<span class="w"> </span>gfortran
<span class="o">!!</span>%cflags:<span class="w"> </span>-fopenmp

<span class="n">PROGRAM</span> <span class="n">Parallel_Hello_World</span>
<span class="n">USE</span> <span class="n">OMP_LIB</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>PARALLEL

  <span class="n">PRINT</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>END<span class="w"> </span>PARALLEL

<span class="n">END</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Hello World
 Hello World
 Hello World
 Hello World
 Hello World
 Hello World
 Hello World
 Hello World
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!!</span>%compiler:<span class="w"> </span>gfortran
<span class="o">!!</span>%cflags:<span class="w"> </span>-fopenmp

<span class="n">PROGRAM</span> <span class="n">Parallel_Hello_World</span>
<span class="n">USE</span> <span class="n">OMP_LIB</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>PARALLEL<span class="w"> </span>num_threads<span class="o">(</span><span class="m">4</span><span class="o">)</span>

  <span class="n">PRINT</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>END<span class="w"> </span>PARALLEL

<span class="n">END</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Hello World
 Hello World
 Hello World
 Hello World
</pre></div>
</div>
</div>
</div>
</section>
<section id="syntax-and-semantics-of-parallel-directive-and-its-clauses">
<h2><span class="section-number">2.2.2. </span>Syntax and Semantics of <strong>Parallel</strong> Directive and Its Clauses<a class="headerlink" href="#syntax-and-semantics-of-parallel-directive-and-its-clauses" title="Link to this heading">#</a></h2>
<p>Through the examples shown in the last section, it is not difficult to conclude that the syntax of the <strong>parallel</strong> directive in C is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma omp parallel [clause[ [,] clause] ... ] new-line</span>
    <span class="n">structured</span><span class="o">-</span><span class="n">block</span>
</pre></div>
</div>
<p>The syntax of the <strong>parallel</strong> directive in Fortran is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!$omp parallel do [clause[ [,] clause] ... ]
    loop-nest
[!$omp end parallel do]
</pre></div>
</div>
<p>As we have already introduced in chapter 1, clauses are used to specify additional information with the directive.
Ten clauses can be used with the <strong>parallel</strong> directive, listing as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">([</span> <span class="n">parallel</span> <span class="p">:]</span> <span class="n">scalar</span><span class="o">-</span><span class="n">expression</span><span class="p">)</span>
<span class="n">num_threads</span><span class="p">(</span><span class="n">integer</span><span class="o">-</span><span class="n">expression</span><span class="p">)</span>
<span class="n">default</span><span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">sharing</span><span class="o">-</span><span class="n">attribute</span><span class="p">)</span>
<span class="n">private</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">firstprivate</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">shared</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">copyin</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">reduction</span><span class="p">([</span><span class="n">reduction</span><span class="o">-</span><span class="n">modifier</span> <span class="p">,]</span> <span class="n">reduction</span><span class="o">-</span><span class="n">identifier</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span>
<span class="n">proc_bind</span><span class="p">(</span><span class="n">affinity</span><span class="o">-</span><span class="n">policy</span><span class="p">)</span>
<span class="n">allocate</span><span class="p">([</span><span class="n">allocator</span> <span class="p">:]</span> <span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<section id="if-clause">
<h3><span class="section-number">2.2.2.1. </span><strong>if</strong> Clause<a class="headerlink" href="#if-clause" title="Link to this heading">#</a></h3>
<p>The <strong>if</strong> clause is used to achieve conditional parallelism. It can be used with many directives, such as <strong>parallel</strong> directive, <strong>task</strong> directive, <strong>simd</strong> directive, etc. Its effect depends on the construct to which it is applied. The syntax is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">([</span> <span class="n">directive</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">modifier</span> <span class="p">:]</span> <span class="n">scalar</span><span class="o">-</span><span class="n">expression</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">([</span> <span class="n">directive</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">modifier</span> <span class="p">:]</span> <span class="n">scalar</span><span class="o">-</span><span class="n">logical</span><span class="o">-</span><span class="n">expression</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>directive-name-modifier</em> is optional and is very useful in combined constructs, which we will cover in the later chapters. When the <strong>if</strong> claue is used with the <strong>parallel</strong> directive, only <em>parallel</em> can be used as the <em>directive-name-modifier</em>. Its semantics are that the parallel region is active when the <em>scaler-expression</em> or <em>scalar-logical-expression</em> is true, otherwise the parallel region that follows will be inactive. At most one <strong>if</strong> clause can be used in each parallel construct.</p>
</section>
<section id="num-threads-clause">
<h3><span class="section-number">2.2.2.2. </span><strong>num_threads</strong> Clause<a class="headerlink" href="#num-threads-clause" title="Link to this heading">#</a></h3>
<p>The syntax for <strong>num_threads</strong> is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_threads</span><span class="p">(</span><span class="n">integer</span><span class="o">-</span><span class="n">expression</span><span class="p">)</span>
</pre></div>
</div>
<p>We used the <strong>num_threads</strong> clause in the previous example to indicate the number of threads used to execute parallel regions.
The number of threads in the parallel region is determined by <em>integer-expression</em>. At most one <strong>num_threads</strong> clause can be used in each parallel construct. Because the number of threads used must be uniquely determined when entering the parallel region， whether explicitly specified by the programmer using <strong>num_threads</strong> clause or implicitly specified by the compiler. Of course, the <em>scaler-expression</em> must be an integer greater than zero.</p>
</section>
<section id="data-sharing-attribute-clauses">
<h3><span class="section-number">2.2.2.3. </span>Data-Sharing Attribute Clauses<a class="headerlink" href="#data-sharing-attribute-clauses" title="Link to this heading">#</a></h3>
<p>Data-sharing attribute clauses are used to control the data-sharing attributes of variables.</p>
<p>There are four data-sharing attribute clauses that can be used with the <strong>parallel</strong> directive, namely <strong>default</strong> clause, <strong>private</strong> clause, <strong>firstprivate</strong> clause and <strong>shared</strong> clause. The <strong>lastprivate</strong> clause and <strong>linear</strong> clause are two other data-sharing attribute clauses. They cannot be used with <strong>parallel</strong> directives, so we will skip them for now and describe them in detail in later chapters.</p>
<p>We first introduce the <strong>private</strong> clause, <strong>firstprivate</strong> clause and <strong>shared</strong> clause.</p>
<section id="private-clause">
<h4><span class="section-number">2.2.2.3.1. </span><strong>private</strong> Clause<a class="headerlink" href="#private-clause" title="Link to this heading">#</a></h4>
<p>The syntax of the <strong>private</strong> clause is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>As mentioned before, a set of implicit tasks, equal in number to the number of threads in the team, is generated by the master thread when it encountering the parallel region.
The <strong>private</strong> caluse is used to declare private variable(s) in the <em>list</em> for a task or a SIMD lane. A private variable has a different address in the execution context of every thread. These variables are private to threads, and threads cannot access private variables owned by other threads. Programmers can use the <strong>private</strong> clause as many times as needed.</p>
</section>
<section id="firstprivate-clause">
<h4><span class="section-number">2.2.2.3.2. </span><strong>firstprivate</strong> Clause<a class="headerlink" href="#firstprivate-clause" title="Link to this heading">#</a></h4>
<p>The <strong>firstprivate</strong> clause is very similar to the <strong>private</strong> clause. They both indicate that the variables in the <em>list</em> are private to the thread. Its syntax is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">firstprivate</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>But unlike the <strong>private</strong> clause, the variables in the <em>list</em> are initialized to the initial value that the original item had in the serial area. Like <strong>private</strong> clause, the <strong>firstprivate</strong> clause can be used multiple times in the parallel construct.</p>
</section>
<section id="shared-clause">
<h4><span class="section-number">2.2.2.3.3. </span><strong>shared</strong> Clause<a class="headerlink" href="#shared-clause" title="Link to this heading">#</a></h4>
<p>The <strong>shared</strong> clause is used to declare that one or more items in the <em>list</em> can be shared by tasks or SIMD lane. Its syntax is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shared</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>Shared variables have the same address in the execution context of every thread. In a parallel region, all threads or SIMD lanes can access these variables. The <strong>shared</strong> clause can also be used multiple times within a parallel struct.</p>
</section>
<section id="default-clause">
<h4><span class="section-number">2.2.2.3.4. </span><strong>default</strong> Clause<a class="headerlink" href="#default-clause" title="Link to this heading">#</a></h4>
<p>The syntax of <strong>default</strong> clause：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">sharing</span><span class="o">-</span><span class="n">attribute</span><span class="p">)</span>
</pre></div>
</div>
<p>The <strong>default</strong> clause is used to define the default data-sharing attribute of variables in a parallel construct(it also can be used in a teams, or task-generating construct).
The <em>data-sharing-attribute</em> is one of the following:</p>
<blockquote>
<div><p>private <br />
firstprivate <br />
shared <br />
none</p>
</div></blockquote>
<p>When the data-sharing attribute of a variable is not specified, the data-sharing attribute of this variable will be set to the attribute specified in the <strong>default</strong> clause. If we have a variable <em>a</em> and the <em>data-sharing-attribute</em> in the <strong>default</strong> clause is <em>shared</em>, then we can understand it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">variable</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">assigned</span> <span class="n">data</span><span class="o">-</span><span class="n">sharing</span> <span class="n">attribute</span> <span class="o">&amp;&amp;</span> <span class="n">we</span> <span class="n">have</span> <span class="n">clause</span> <span class="n">default</span><span class="p">(</span><span class="n">shared</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">equals</span> <span class="n">to</span> <span class="p">:</span> <span class="n">we</span> <span class="n">have</span> <span class="n">clause</span> <span class="n">shared</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A special note for the <strong>default(none)</strong> clause:</p>
<blockquote>
<div><p>The <strong>default(none)</strong> clause means that we do not define any data-sharing attribute for variables. The compiler does not implicitly define this for us, therefore, the variables need to be listed explicitly in other data-sharing attribute clauses.</p>
</div></blockquote>
<p>Unlike the above three clauses, <strong>default</strong> clause can only appear once in a directive.</p>
</section>
<section id="implicit-scoping-rules">
<h4><span class="section-number">2.2.2.3.5. </span>Implicit Scoping Rules<a class="headerlink" href="#implicit-scoping-rules" title="Link to this heading">#</a></h4>
<p>You may ask, if the <strong>default</strong> clause is not used, what data-sharing attribute is the variable that is not explicitly listed in other clauses? In fact, OpenMP defines a set of implicit scope rules. It determines the data-sharing attribute of a variable based on the characteristics of the variable being accessed. For example, for threads in a group, a variable is scoped to <em>shared</em> if using this variable in the parallel region does not result in a data race condition. A variable is scoped to <em>private</em> if, in each thread executing the parallel region, the variable is always written before being read by the same thread. The detailed rules can be found in the OpenMP specification.</p>
<p>Although OpenMP proposes as detailed and explicit rules as possible for implicit scoping, there is still a high possibility of unpredictable errors. Therefore, it is undoubtedly the best choice for programmers to use clauses to explicitly specify the data-sharing attributes of variables. This is an important aspect of OpenMP program optimization.</p>
</section>
</section>
<section id="copyin-clause">
<h3><span class="section-number">2.2.2.4. </span><strong>copyin</strong> Clause<a class="headerlink" href="#copyin-clause" title="Link to this heading">#</a></h3>
<p>The <strong>copyin</strong> clause is the one of two data copying clauses that can be used on the <strong>parallel</strong> construct or combined parallel worksharing constructs. The other one is the <strong>copyprivate</strong> clause which is only allowed on the <strong>single</strong> construct.</p>
<p>Before introducing these two clauses, we need to introduce a new data-sharing attribute, named <em>threadprivate</em>. The difference between private variables and thread private variables can be briefly described as follows:</p>
<ul class="simple">
<li><p>Private variables are local to a region and are placed on the stack most of the time. The lifetime of a private variable is the duration defined by the data scope clause. Every thread, including the main thread, makes a private copy of the original variable, and the new variable is no longer storage-associated to the original.</p></li>
<li><p>Threadprivate variables are persist across regions, most likely to be placed in the heap or in thread-local storage, which can be seen as being stored in a local memory local to the thread. The main thread uses the original variable and other threads make private copies of the original variable. The host variable is still store-associated with the original variable.</p></li>
</ul>
<p>The syntax of the <strong>copyin</strong> Clause is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">copyin</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>It can copy the value of the main thread’s threadprivate variable into the threadprivate variable of every other member in the team that is executing the parallel region. And it can be used multiple times within a parallel struct.</p>
</section>
<section id="reduction-clause">
<h3><span class="section-number">2.2.2.5. </span><strong>reduction</strong> Clause<a class="headerlink" href="#reduction-clause" title="Link to this heading">#</a></h3>
<p>The <strong>reduction</strong> clause belongs to the <em>reduction scoping clauses</em> and the <em>reduction participating clauses</em>. The <em>reduction scoping clauses</em> define the region of a reduction computed by a task or a SIMD lane. The <em>reduction participating clauses</em> are used to define a task or SIMD channel as a reduction participant. The <strong>reduction</strong> clause is specifically designed for reduction operations, and it allows the user to specify one or more thread-private variables that accept reduction operation at the end of the parallel region.</p>
<p>The syntax of the <strong>reduction</strong> clause is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reduction</span><span class="p">([</span> <span class="n">reduction</span><span class="o">-</span><span class="n">modifier</span><span class="p">,]</span><span class="n">reduction</span><span class="o">-</span><span class="n">identifier</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>reduction-modifier</em> is optional and is used to describe the characteristics of the reduction operation. It can be one of the following:</p>
<blockquote>
<div><p>inscan <br />
task <br />
default</p>
</div></blockquote>
<p>When the <em>reduction-modifier</em> is <em>inscan</em>, the list items on each iteration of a loop nest will be updated with scan computation.
When <em>inscan</em> is used, one list item must be as a list item in an <strong>inclusive</strong> or <strong>exclusive</strong> clause on a <strong>scan</strong> directive enclosed by the construct.
It separates the items in the list from the reduction operations, and decides whether the storage statement includes or excludes the scan input of the present iteration.</p>
<p>When the <em>reduction-modifier</em> is <em>task</em>, an indeterminate number of additional private copies will be generated to support task reduction, and these reduction-related copies will be initialized before they are accessed by the tasks.</p>
<p>When <em>reduction-modifier</em> is <em>default</em> or when no <em>reduction-modifier</em> is specified, the behavior will be relative to the construct in which the reduction is located. For <strong>parallel</strong>, <strong>scope</strong> and <strong>simd</strong> construcrs, one or more private copies of each list item are created for each implicit task (for <strong>parallel</strong> and <strong>scope</strong>) or SIMD lane (for <strong>simd</strong>), as if the <strong>private</strong> clause had been used. Some other rules for other constructs can be found in the OpenMP specification and we will not go into details here.</p>
<p>The <em>reduction-identifier</em> is used to specify the reduction operator.
According to the OpenMP specification, the <em>reduction-identifier</em> has the following syntax:</p>
<ul class="simple">
<li><p>For C language，a <em>reduction-identifier</em> is either an identifier or one of the following operators: +, - (deprecated), *, &amp;, |, ^, &amp;&amp; and ||.</p></li>
<li><p>For C++, a <em>reduction-identifier</em> is either an id-expression or one of the following operators: +, - (deprecated), *, &amp;, |, ^, &amp;&amp; and ||.</p></li>
<li><p>For Fortran， a <em>reduction-identifier</em> is either a base language identifier, or a user-defined operator, or one of the following operators: +, - (deprecated), *, .and., .or., .eqv., .neqv., or one of the following intrinsic procedure names: max, min, iand, ior, ieor.</p></li>
</ul>
<p>The following two tables, also from the OpenMP specification, show implicitly declared reduction-identifiers for numeric and logical types, including the initial value settings, and semantics for the reduction-identifiers.</p>
<p>For C/C++:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Identifier</p></th>
<th class="head"><p>Initializer</p></th>
<th class="head"><p>Combiner</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out += omp_in</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out += omp_in</p></td>
</tr>
<tr class="row-even"><td><p>*</p></td>
<td><p>omp_priv = 1</p></td>
<td><p>omp_out *= omp_in</p></td>
</tr>
<tr class="row-odd"><td><p>&amp;</p></td>
<td><p>omp_priv = ~ 0</p></td>
<td><p>omp_out &amp;= omp_in</p></td>
</tr>
<tr class="row-even"><td><p>|</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out |= omp_in</p></td>
</tr>
<tr class="row-odd"><td><p>^</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out ^= omp_in</p></td>
</tr>
<tr class="row-even"><td><p>&amp;&amp;</p></td>
<td><p>omp_priv = 1</p></td>
<td><p>omp_out = omp_in &amp;&amp; omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>||</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out = omp_in</p></td>
</tr>
<tr class="row-even"><td><p>max</p></td>
<td><p>omp_priv = Minimal representable number in the reduction list item type</p></td>
<td><p>omp_out = omp_in &gt; omp_out ? omp_in : omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>min</p></td>
<td><p>omp_priv = Maximal representable number in the reduction list item type</p></td>
<td><p>omp_out = omp_in &lt; omp_out ? omp_in : omp_out</p></td>
</tr>
</tbody>
</table>
<p>For Fortran：</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Identifier</p></th>
<th class="head"><p>Initializer</p></th>
<th class="head"><p>Combiner</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out = omp_in + omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>-</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out = omp_in + omp_out</p></td>
</tr>
<tr class="row-even"><td><p>*</p></td>
<td><p>omp_priv = 1</p></td>
<td><p>omp_out = omp_in * omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>.and.</p></td>
<td><p>omp_priv = .true.</p></td>
<td><p>omp_out = omp_in .and. omp_out</p></td>
</tr>
<tr class="row-even"><td><p>.or.</p></td>
<td><p>omp_priv = .false.</p></td>
<td><p>omp_out = omp_in .or. omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>.eqv.</p></td>
<td><p>omp_priv = .true.</p></td>
<td><p>omp_out = omp_in .eqv. omp_out</p></td>
</tr>
<tr class="row-even"><td><p>.neqv.</p></td>
<td><p>omp_priv = .false.</p></td>
<td><p>omp_out = omp_in .neqv. omp_out</p></td>
</tr>
<tr class="row-odd"><td><p>max</p></td>
<td><p>omp_priv = Minimal representable number in the reduction list item type</p></td>
<td><p>omp_out = max(omp_in, omp_out)</p></td>
</tr>
<tr class="row-even"><td><p>min</p></td>
<td><p>omp_priv = Maximal representable number in the reduction list item type</p></td>
<td><p>omp_out = min(omp_in, omp_out)</p></td>
</tr>
<tr class="row-odd"><td><p>iand</p></td>
<td><p>omp_priv = All bits on</p></td>
<td><p>omp_out = iand(omp_in, omp_out)</p></td>
</tr>
<tr class="row-even"><td><p>ior</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out = ior(omp_in, omp_out)</p></td>
</tr>
<tr class="row-odd"><td><p>ieor</p></td>
<td><p>omp_priv = 0</p></td>
<td><p>omp_out = ieor(omp_in, omp_out)</p></td>
</tr>
</tbody>
</table>
<p>The <strong>reduction</strong> clause can be used multiple times as needed within a parallel struct.</p>
</section>
<section id="proc-bind-clause">
<h3><span class="section-number">2.2.2.6. </span><strong>proc_bind</strong> Clause<a class="headerlink" href="#proc-bind-clause" title="Link to this heading">#</a></h3>
<p>The <strong>proc_bind</strong> clause is used to specify a mapping of OpenMP threads to places within the current place partition for implicit tasks of the encountering threads. At most one proc_bind clause can appear on the directive. Its syntax is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proc_bind</span><span class="p">(</span><span class="n">affinity</span><span class="o">-</span><span class="n">policy</span><span class="p">)</span> 
</pre></div>
</div>
<p>and the <em>affinity-policy</em> is one of the following：</p>
<blockquote>
<div><p>primary <br />
master [deprecated] <br />
close  <br />
spread</p>
</div></blockquote>
<p>When <em>affinity-policy</em> is specified as <em>primary</em>, it means that the execution environment assigns each thread in the group to the same location as the primary thread.
The <em>master</em> affinity policy has been deprecated, it has identical semantics as <em>prime</em>.</p>
<p>The <em>close</em> thread affinity policy instructs the execution environment to assign threads in the group closer to the parent thread’s location. When the number of threads <strong>P</strong> in the group is less than the number of locations <strong>P</strong> in the partition where the parent thread is located, each thread will be assigned one place, otherwise, <strong>T/P</strong> threads will be assigned to one place. When <strong>P</strong> does not divide <strong>T</strong> equally, the exact number of threads at a particular place is implementation-defined. The principle of allocation is that the thread number with the thread with the smallest thread number is executed at the position of the parent thread, and then the threads are allocated backward in the order of increasing thread number, and wrap-around with respect to the place partition of the primary thread.</p>
<p>The <em>spread</em> thread affinity policy is to create <strong>P</strong> sub-partitions in the parent partition and distribute the threads in these sub-partitions, thus achieving a sparse distribution.
When the number of threads is equal to or less than <strong>P</strong>, the number of sub-partitions is equal to the number of threads <strong>T</strong>, and the threads are distributed in the first position of each partition in order of thread number from small to large. Conversely, when the number of threads is greater than <strong>P</strong>, <strong>T/P</strong> threads with consecutive thread numbers are allocated to each sub-partition.
Sorted by thread number, the first <strong>T/P</strong> threads are allocated in the subpartition that contains the place of the parent thread. The remaining thread groups are allocated backward in turn, with a wrap-around with respect to the original place partition of the primary thread.</p>
</section>
<section id="allocate-clause">
<h3><span class="section-number">2.2.2.7. </span><strong>allocate</strong> Clause<a class="headerlink" href="#allocate-clause" title="Link to this heading">#</a></h3>
<p>The <strong>allocate</strong> clause is used to specify the memory allocator used to obtain storage of the private variables. When it is used with <strong>parallel</strong> construct, the syntax is shown as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">allocate</span><span class="p">([</span><span class="n">allocator</span><span class="p">:]</span> <span class="nb">list</span><span class="p">)</span> 
</pre></div>
</div>
<p>In C/C++, the <em>allocator</em> is an expression of the omp_allocator_handle_t type. In Fortran, the <em>allocator</em> is an integer expression of the omp_allocator_handle_kindkind.
We will not list these allocators here, readers can find them in the OpenMP specification, but we will explain some commonly used allocators in the examples in the following section.</p>
<p>The <strong>allocate</strong> clause can be used multiple times as needed within a parallel struct.</p>
</section>
</section>
<section id="more-advanced-examples-of-using-other-clauses-and-the-analysis-of-performance-and-improvement">
<h2><span class="section-number">2.2.3. </span>More Advanced Examples of Using Other Clauses and the Analysis of Performance and Improvement<a class="headerlink" href="#more-advanced-examples-of-using-other-clauses-and-the-analysis-of-performance-and-improvement" title="Link to this heading">#</a></h2>
<p>In the above section, we have introduced the syntax and semantics of all the clauses that can be used with the parallel directive. In this section, we introduce some examples of how to use these clauses.</p>
<p>Meanwhile, in some of the examples, we will show some ways to improve performance, and discuss some potential possibilities for improving performance.</p>
<section id="if-clause-and-num-threads-clause">
<h3><span class="section-number">2.2.3.1. </span><strong>if</strong> clause and <strong>num_threads</strong> clause<a class="headerlink" href="#if-clause-and-num-threads-clause" title="Link to this heading">#</a></h3>
<p>The <strong>if</strong> clause can achieve conditional parallelism and the <strong>num_threads</strong> clause will identify the number of threads used. In the following example, we use three cases to display the effect of the if clause and the <strong>num_trheads</strong> clause. No <strong>if</strong> clause is used in case 1, and the <strong>num_threads</strong> clause indicated we should use 4 threads, so we can get the output from four threads in parallel. The scalar expression in the <strong>if</strong> clause in case 2 is evaluated to be false, so the statements following the openMP directive (maybe code block in other cases) will be executed serially by only one thread. And in case 3, the scalar expression is evaluated to be true, so the statements following the openMP directive will be executed parallel by four threads.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">//%</span><span class="k">compiler</span>: clang
<span class="o">//%</span><span class="k">cflags</span>: -fopenmp

<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;omp.h&gt;</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="nb">int</span> <span class="n">M</span> <span class="o">=</span><span class="mi">10</span><span class="p">;</span>
    <span class="o">//</span><span class="n">case</span> <span class="mi">1</span>
    <span class="c1">#pragma omp parallel num_threads(4)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Hello World in case 1 from thread </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">());</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    
    <span class="o">//</span><span class="n">case</span> <span class="mi">2</span>
    <span class="c1">#pragma omp parallel num_threads(4) if(M &gt; 10)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Hello World in case 2 from thread </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">());</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    
    <span class="o">//</span><span class="n">case</span> <span class="mi">3</span>
    <span class="c1">#pragma omp parallel num_threads(4) if(M &lt;= 10)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Hello World in case 3 from thread </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">omp_get_thread_num</span><span class="p">());</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hello World in case 1 from thread 2
Hello World in case 1 from thread 3
Hello World in case 1 from thread 1
Hello World in case 1 from thread 0
-------------------------------------------------
Hello World in case 2 from thread 0
-------------------------------------------------
Hello World in case 3 from thread 3
Hello World in case 3 from thread 1
Hello World in case 3 from thread 0
Hello World in case 3 from thread 2
</pre></div>
</div>
</div>
</div>
<p>Within a parallel region, the thread number uniquely identifies each thread. A thread can obtain its own thread number by calling the <strong>omp_get_thread_num</strong> library routine.</p>
</section>
<section id="id1">
<h3><span class="section-number">2.2.3.2. </span>Data-Sharing Attribute Clauses<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>The following example is a little more complicated. It shows how to use the <strong>omp_get_thread_num</strong> library routine and shows how to use two other clauses, the <strong>default</strong> clause and the <strong>private</strong> clause. It assigns tasks to each thread explicitly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">//%</span><span class="k">compiler</span>: clang
<span class="o">//%</span><span class="k">cflags</span>: -fopenmp
<span class="o">//</span><span class="n">This</span> <span class="n">example</span> <span class="ow">is</span> <span class="kn">from</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">openmp</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">content</span><span class="o">/</span><span class="n">uploads</span><span class="o">/</span><span class="n">openmp</span><span class="o">-</span><span class="n">examples</span><span class="o">-</span><span class="mf">5.1</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span> <span class="n">The</span> <span class="n">size</span> <span class="n">of</span> <span class="n">array</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">are</span> <span class="n">changed</span>

<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;omp.h&gt;</span>

<span class="n">void</span> <span class="n">subdomain</span><span class="p">(</span><span class="nb">float</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">istart</span><span class="p">,</span> <span class="nb">int</span> <span class="n">ipoints</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ipoints</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>       
         <span class="n">x</span><span class="p">[</span><span class="n">istart</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">istart</span><span class="o">+</span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">sub</span><span class="p">(</span><span class="nb">float</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">npoints</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">iam</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ipoints</span><span class="p">,</span> <span class="n">istart</span><span class="p">;</span>
    <span class="c1">#pragma omp parallel default(shared) private(iam,nt,ipoints,istart)</span>
    <span class="p">{</span>
        <span class="n">iam</span> <span class="o">=</span> <span class="n">omp_get_thread_num</span><span class="p">();</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">omp_get_num_threads</span><span class="p">();</span>
        <span class="n">ipoints</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">/</span> <span class="n">nt</span><span class="p">;</span> <span class="o">/*</span> <span class="n">size</span> <span class="n">of</span> <span class="n">partition</span> <span class="o">*/</span>
        <span class="n">istart</span> <span class="o">=</span> <span class="n">iam</span> <span class="o">*</span> <span class="n">ipoints</span><span class="p">;</span> <span class="o">/*</span> <span class="n">starting</span> <span class="n">array</span> <span class="n">index</span> <span class="o">*/</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iam</span> <span class="o">==</span> <span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/*</span> <span class="n">last</span> <span class="n">thread</span> <span class="n">may</span> <span class="n">do</span> <span class="n">more</span> <span class="o">*/</span>
            <span class="n">ipoints</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">-</span> <span class="n">istart</span><span class="p">;</span>
        <span class="n">subdomain</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">istart</span><span class="p">,</span> <span class="n">ipoints</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">void</span> <span class="nb">print</span><span class="p">(</span><span class="nb">float</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">npoints</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">npoints</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">float</span> <span class="n">array</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="n">sub</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00000 1.00000 2.00000 3.00000 4.00000 5.00000 6.00000 7.00000 8.00000 9.00000 
10.00000 11.00000 12.00000 13.00000 14.00000 15.00000 16.00000 17.00000 18.00000 19.00000 
20.00000 21.00000 22.00000 23.00000 24.00000 25.00000 26.00000 27.00000 28.00000 29.00000 
30.00000 31.00000 32.00000 33.00000 34.00000 35.00000 36.00000 37.00000 38.00000 39.00000 
40.00000 41.00000 42.00000 43.00000 44.00000 45.00000 46.00000 47.00000 48.00000 49.00000 
50.00000 51.00000 52.00000 53.00000 54.00000 55.00000 56.00000 57.00000 58.00000 59.00000 
60.00000 61.00000 62.00000 63.00000 64.00000 65.00000 66.00000 67.00000 68.00000 69.00000 
70.00000 71.00000 72.00000 73.00000 74.00000 75.00000 76.00000 77.00000 78.00000 79.00000 
80.00000 81.00000 82.00000 83.00000 84.00000 85.00000 86.00000 87.00000 88.00000 89.00000 
90.00000 91.00000 92.00000 93.00000 94.00000 95.00000 96.00000 97.00000 98.00000 99.00000 
</pre></div>
</div>
</div>
</div>
<p>In the above example, we use the default number of threads to perform assignment operations on 100 elements in the array. Tasks are evenly distributed to each thread, and when the number of tasks is not divisible by the number of threads, the remaining tasks will be completed by the last thread.</p>
<p>When programming in parallel, the most important and hardest part is how to assign tasks and manage threads. We already introduced that a thread can get its own id through the <strong>omp_get_thread_num</strong> routine. Another important routine is <strong>omp_get_num_threads</strong>, which returns the number of threads in the current team.</p>
<p>In the above example, variable <em>npoints</em> presents the total number of elements in the array, and it is divided into <em>nt</em> parts, each of size <em>ipoints</em>. The starting address of each part is <em>istart</em>. Each part is completed by one thread, and a total of 8 threads execute tasks in parallel.</p>
<p>The <strong>default</strong> clause is used to define the default data-sharing attributes of variables that are referenced in a parallel, teams, or task-generating construct. In the above example, <em>default(shared)</em> indicates that by default, the variables in the parallel region are shared variables.
The <strong>private</strong> clause is used to explicitly specify variables that are private in each task or SIMD lane (SIMD will be introduced in the next chapter). In the above example, the variables <em>iam, nt, ipoints</em> and <em>istart</em> are private variables for each thread, which means a thread cannot access these variables of another thread.</p>
<p>The corresponding Fortran program is shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!!</span>%compiler:<span class="w"> </span>gfortran
<span class="o">!!</span>%cflags:<span class="w"> </span>-fopenmp

    <span class="n">SUBROUTINE</span> <span class="n">SUBDOMAIN</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ISTART</span><span class="p">,</span> <span class="n">IPOINTS</span><span class="p">)</span>
        <span class="n">INTEGER</span> <span class="n">ISTART</span><span class="p">,</span> <span class="n">IPOINTS</span>
        <span class="n">REAL</span> <span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">99</span><span class="p">)</span>

        <span class="n">INTEGER</span> <span class="n">I</span>

        <span class="n">DO</span> <span class="mi">100</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">IPOINTS</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">X</span><span class="p">(</span><span class="n">ISTART</span><span class="o">+</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">ISTART</span><span class="o">+</span><span class="n">I</span>
<span class="mi">100</span>     <span class="n">CONTINUE</span>

    <span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">SUBDOMAIN</span>

    <span class="n">SUBROUTINE</span> <span class="n">SUB</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">NPOINTS</span><span class="p">)</span>
        <span class="n">INCLUDE</span> <span class="s2">&quot;omp_lib.h&quot;</span> <span class="o">!</span><span class="w"> </span>or<span class="w"> </span>USE<span class="w"> </span>OMP_LIB

        <span class="n">REAL</span> <span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">INTEGER</span> <span class="n">NPOINTS</span>
        <span class="n">INTEGER</span> <span class="n">IAM</span><span class="p">,</span> <span class="n">NT</span><span class="p">,</span> <span class="n">IPOINTS</span><span class="p">,</span> <span class="n">ISTART</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>PARALLEL<span class="w"> </span>DEFAULT<span class="o">(</span>PRIVATE<span class="o">)</span><span class="w"> </span>SHARED<span class="o">(</span>X,NPOINTS<span class="o">)</span>

        <span class="n">IAM</span> <span class="o">=</span> <span class="n">OMP_GET_THREAD_NUM</span><span class="p">()</span>
        <span class="n">NT</span> <span class="o">=</span> <span class="n">OMP_GET_NUM_THREADS</span><span class="p">()</span>
        <span class="n">IPOINTS</span> <span class="o">=</span> <span class="n">NPOINTS</span><span class="o">/</span><span class="n">NT</span>
        <span class="n">ISTART</span> <span class="o">=</span> <span class="n">IAM</span> <span class="o">*</span> <span class="n">IPOINTS</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">IAM</span> <span class="o">.</span><span class="n">EQ</span><span class="o">.</span> <span class="n">NT</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">IPOINTS</span> <span class="o">=</span> <span class="n">NPOINTS</span> <span class="o">-</span> <span class="n">ISTART</span>
        <span class="n">ENDIF</span>
        <span class="n">CALL</span> <span class="n">SUBDOMAIN</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">ISTART</span><span class="p">,</span><span class="n">IPOINTS</span><span class="p">)</span>

<span class="o">!</span><span class="nv">$OMP</span><span class="w"> </span>END<span class="w"> </span>PARALLEL
    <span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">SUB</span>
    
    <span class="n">SUBROUTINE</span> <span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">NPOINTS</span><span class="p">)</span>
        <span class="n">INTEGER</span> <span class="n">I</span>
        <span class="n">REAL</span> <span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">INTEGER</span> <span class="n">NPOINTS</span>
        <span class="n">DO</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">NPOINTS</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">IF</span> <span class="p">(</span><span class="n">mod</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">.</span><span class="n">EQ</span><span class="o">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
                <span class="nb">print</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39; &#39;</span>
            <span class="n">END</span> <span class="n">IF</span>
            <span class="n">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,f9.5,$)&#39;</span><span class="p">)</span> <span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        <span class="n">END</span> <span class="n">DO</span>
    <span class="n">END</span> <span class="n">SUBROUTINE</span> <span class="n">PRINT</span>

    <span class="n">PROGRAM</span> <span class="n">PAREXAMPLE</span>
        <span class="n">REAL</span> <span class="n">ARRAY</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">CALL</span> <span class="n">SUB</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">CALL</span> <span class="n">PRINT</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">END</span> <span class="n">PROGRAM</span> <span class="n">PAREXAMPLE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  
   0.00000   1.00000   2.00000   3.00000   4.00000   5.00000   6.00000   7.00000   8.00000   9.00000  
  10.00000  11.00000  12.00000  13.00000  14.00000  15.00000  16.00000  17.00000  18.00000  19.00000  
  20.00000  21.00000  22.00000  23.00000  24.00000  25.00000  26.00000  27.00000  28.00000  29.00000  
  30.00000  31.00000  32.00000  33.00000  34.00000  35.00000  36.00000  37.00000  38.00000  39.00000  
  40.00000  41.00000  42.00000  43.00000  44.00000  45.00000  46.00000  47.00000  48.00000  49.00000  
  50.00000  51.00000  52.00000  53.00000  54.00000  55.00000  56.00000  57.00000  58.00000  59.00000  
  60.00000  61.00000  62.00000  63.00000  64.00000  65.00000  66.00000  67.00000  68.00000  69.00000  
  70.00000  71.00000  72.00000  73.00000  74.00000  75.00000  76.00000  77.00000  78.00000  79.00000  
  80.00000  81.00000  82.00000  83.00000  84.00000  85.00000  86.00000  87.00000  88.00000  89.00000  
  90.00000  91.00000  92.00000  93.00000  94.00000  95.00000  96.00000  97.00000  98.00000  99.00000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">//%</span><span class="k">compiler</span>: clang
<span class="o">//%</span><span class="k">cflags</span>: -fopenmp
<span class="o">//</span><span class="n">This</span> <span class="n">example</span> <span class="ow">is</span> <span class="kn">from</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">openmp</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">content</span><span class="o">/</span><span class="n">uploads</span><span class="o">/</span><span class="n">openmp</span><span class="o">-</span><span class="n">examples</span><span class="o">-</span><span class="mf">5.1</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span>

<span class="c1">#include &lt;assert.h&gt;</span>

<span class="nb">int</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>

<span class="n">void</span> <span class="n">f</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="nb">int</span> <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="nb">int</span> <span class="n">C</span><span class="p">[])</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>
    <span class="nb">int</span> <span class="n">E</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">];</span>

    <span class="k">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="c1">#pragma omp parallel firstprivate(B, C, D, E)</span>
    <span class="p">{</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)[</span><span class="n">n</span><span class="p">]));</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">==</span> <span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span><span class="o">*</span><span class="p">));</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span><span class="p">));</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span><span class="p">));</span>

        <span class="o">/*</span> <span class="n">Private</span> <span class="n">B</span> <span class="ow">and</span> <span class="n">C</span> <span class="n">have</span> <span class="n">values</span> <span class="n">of</span> <span class="n">original</span> <span class="n">B</span> <span class="ow">and</span> <span class="n">C</span><span class="o">.</span> <span class="o">*/</span>
        <span class="k">assert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">assert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>In the above example, we explored how to use the <strong>firstprivate</strong> clause. The size and values of the array or pointer appearing in the list of the <strong>firstprivate</strong> clause depend on the original arrays or pointers in the serial part.
The type of A is array of two arrays of two ints. B and C are function variables, which will be adjusted according to the type defined in the function. The type of B is pointer to array of n ints, and the type of C is pointer to int. The type of D is exactly the same as A, and the type of E is array of n arrays of n ints.</p>
<p>In the example, we use multiple assert statements to check whether B, C, D, and E have the expected types and values. Thus to verify the function of the <strong>firstprivate</strong> clause.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./MultiCoreMultiCPU"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1_MIMDArchitecture.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2.1. </span>Multicore and Multi-CPU shared memory systems</p>
      </div>
    </a>
    <a class="right-next"
       href="3_UsingOpenMP_teams.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2.3. </span>Creating SPMD parallelism using OpenMP <code class="docutils literal notranslate"><span class="pre">teams</span></code> directive</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-started-with-parallel-directive-to-create-parallelism">2.2.1. Get Started with <strong>Parallel</strong> Directive to Create Parallelism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax-and-semantics-of-parallel-directive-and-its-clauses">2.2.2. Syntax and Semantics of <strong>Parallel</strong> Directive and Its Clauses</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-clause">2.2.2.1. <strong>if</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#num-threads-clause">2.2.2.2. <strong>num_threads</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sharing-attribute-clauses">2.2.2.3. Data-Sharing Attribute Clauses</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#private-clause">2.2.2.3.1. <strong>private</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#firstprivate-clause">2.2.2.3.2. <strong>firstprivate</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-clause">2.2.2.3.3. <strong>shared</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#default-clause">2.2.2.3.4. <strong>default</strong> Clause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-scoping-rules">2.2.2.3.5. Implicit Scoping Rules</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copyin-clause">2.2.2.4. <strong>copyin</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-clause">2.2.2.5. <strong>reduction</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proc-bind-clause">2.2.2.6. <strong>proc_bind</strong> Clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#allocate-clause">2.2.2.7. <strong>allocate</strong> Clause</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-advanced-examples-of-using-other-clauses-and-the-analysis-of-performance-and-improvement">2.2.3. More Advanced Examples of Using Other Clauses and the Analysis of Performance and Improvement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-clause-and-num-threads-clause">2.2.3.1. <strong>if</strong> clause and <strong>num_threads</strong> clause</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.2.3.2. Data-Sharing Attribute Clauses</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Xinyao Yi, Anjia Wang, and Yonghong Yan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © <a href="../copyright.html">Copyright</a> 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>